{"ast":null,"code":"import _Anchor from \"antd/lib/anchor\";\nvar _jsxFileName = \"E:\\\\myBlog\\\\blog\\\\blog\\\\components\\\\tocify.tsx\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport { last } from 'lodash';\nconst {\n  Link\n} = _Anchor;\n// TOC目录树结构\nexport default class Tocify {\n  constructor() {\n    _defineProperty(this, \"tocItems\", []);\n\n    _defineProperty(this, \"index\", 0);\n\n    _defineProperty(this, \"reset\", () => {\n      this.tocItems = [];\n      this.index = 0;\n    });\n\n    this.tocItems = [];\n    this.index = 0;\n  }\n\n  add(text, level) {\n    const anchor = `toc${level}${++this.index}`;\n    const item = {\n      anchor,\n      level,\n      text\n    };\n    const items = this.tocItems;\n\n    if (items.length === 0) {\n      // 第一个 item 直接 push\n      items.push(item);\n    } else {\n      let lastItem = last(items); // 最后一个 item\n\n      if (item.level > lastItem.level) {\n        // item 是 lastItem 的 children\n        for (let i = lastItem.level + 1; i <= 2; i++) {\n          const {\n            children\n          } = lastItem;\n\n          if (!children) {\n            // 如果 children 不存在\n            lastItem.children = [item];\n            break;\n          }\n\n          lastItem = last(children); // 重置 lastItem 为 children 的最后一个 item\n\n          if (item.level <= lastItem.level) {\n            // item level 小于或等于 lastItem level 都视为与 children 同级\n            children.push(item);\n            break;\n          }\n        }\n      } else {\n        // 置于最顶级\n        items.push(item);\n      }\n    }\n\n    return anchor;\n  }\n\n  renderToc(items) {\n    // 递归 render\n    return items.map(item => __jsx(Link, {\n      key: item.anchor,\n      href: `#${item.anchor}`,\n      title: item.text,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 7\n      }\n    }, item.children && this.renderToc(item.children)));\n  }\n\n  render() {\n    return __jsx(_Anchor, {\n      affix: true,\n      showInkInFixed: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 7\n      }\n    }, this.renderToc(this.tocItems));\n  }\n\n}","map":{"version":3,"sources":["E:/myBlog/blog/blog/components/tocify.tsx"],"names":["React","last","Link","Tocify","constructor","tocItems","index","add","text","level","anchor","item","items","length","push","lastItem","i","children","renderToc","map","render"],"mappings":";;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,SAASC,IAAT,QAAqB,QAArB;AAEA,MAAM;AAAEC,EAAAA;AAAF,WAAN;AASkC;AAElC,eAAe,MAAMC,MAAN,CAAa;AAK1BC,EAAAA,WAAW,GAAG;AAAA,sCAJO,EAIP;;AAAA,mCAFE,CAEF;;AAAA,mCAsCN,MAAM;AACZ,WAAKC,QAAL,GAAgB,EAAhB;AACA,WAAKC,KAAL,GAAa,CAAb;AACD,KAzCa;;AACZ,SAAKD,QAAL,GAAgB,EAAhB;AACA,SAAKC,KAAL,GAAa,CAAb;AACD;;AAEDC,EAAAA,GAAG,CAACC,IAAD,EAAeC,KAAf,EAA8B;AAC/B,UAAMC,MAAM,GAAI,MAAKD,KAAM,GAAE,EAAE,KAAKH,KAAM,EAA1C;AACA,UAAMK,IAAI,GAAG;AAAED,MAAAA,MAAF;AAAUD,MAAAA,KAAV;AAAiBD,MAAAA;AAAjB,KAAb;AACA,UAAMI,KAAK,GAAG,KAAKP,QAAnB;;AAEA,QAAIO,KAAK,CAACC,MAAN,KAAiB,CAArB,EAAwB;AAAE;AACxBD,MAAAA,KAAK,CAACE,IAAN,CAAWH,IAAX;AACD,KAFD,MAEO;AACL,UAAII,QAAQ,GAAGd,IAAI,CAACW,KAAD,CAAnB,CADK,CACkC;;AAEvC,UAAID,IAAI,CAACF,KAAL,GAAaM,QAAQ,CAACN,KAA1B,EAAiC;AAAE;AACjC,aAAK,IAAIO,CAAC,GAAGD,QAAQ,CAACN,KAAT,GAAiB,CAA9B,EAAiCO,CAAC,IAAI,CAAtC,EAAyCA,CAAC,EAA1C,EAA8C;AAC5C,gBAAM;AAAEC,YAAAA;AAAF,cAAeF,QAArB;;AACA,cAAI,CAACE,QAAL,EAAe;AAAE;AACfF,YAAAA,QAAQ,CAACE,QAAT,GAAoB,CAACN,IAAD,CAApB;AACA;AACD;;AAEDI,UAAAA,QAAQ,GAAGd,IAAI,CAACgB,QAAD,CAAf,CAP4C,CAON;;AAEtC,cAAIN,IAAI,CAACF,KAAL,IAAcM,QAAQ,CAACN,KAA3B,EAAkC;AAAE;AAClCQ,YAAAA,QAAQ,CAACH,IAAT,CAAcH,IAAd;AACA;AACD;AACF;AACF,OAfD,MAeO;AAAE;AACPC,QAAAA,KAAK,CAACE,IAAN,CAAWH,IAAX;AACD;AACF;;AAED,WAAOD,MAAP;AACD;;AAODQ,EAAAA,SAAS,CAACN,KAAD,EAAmB;AAAE;AAC5B,WAAOA,KAAK,CAACO,GAAN,CAAUR,IAAI,IACnB,MAAC,IAAD;AAAM,MAAA,GAAG,EAAEA,IAAI,CAACD,MAAhB;AAAwB,MAAA,IAAI,EAAG,IAAGC,IAAI,CAACD,MAAO,EAA9C;AAAiD,MAAA,KAAK,EAAEC,IAAI,CAACH,IAA7D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGG,IAAI,CAACM,QAAL,IAAiB,KAAKC,SAAL,CAAeP,IAAI,CAACM,QAApB,CADpB,CADK,CAAP;AAKD;;AAEDG,EAAAA,MAAM,GAAG;AACP,WACE;AAAQ,MAAA,KAAK,MAAb;AAAc,MAAA,cAAc,MAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,KAAKF,SAAL,CAAe,KAAKb,QAApB,CADH,CADF;AAKD;;AA9DyB","sourcesContent":["import React from 'react';\r\nimport { Anchor } from 'antd';\r\nimport { last } from 'lodash';\r\n\r\nconst { Link } = Anchor;\r\n\r\nexport interface TocItem {\r\n  anchor: string;\r\n  level: number;\r\n  text: string;\r\n  children?: TocItem[];\r\n}\r\n\r\nexport type TocItems = TocItem[]; // TOC目录树结构\r\n\r\nexport default class Tocify {\r\n  tocItems: TocItems = [];\r\n\r\n  index: number = 0;\r\n\r\n  constructor() {\r\n    this.tocItems = [];\r\n    this.index = 0;\r\n  }\r\n\r\n  add(text: string, level: number) {\r\n    const anchor = `toc${level}${++this.index}`;\r\n    const item = { anchor, level, text };\r\n    const items = this.tocItems;\r\n\r\n    if (items.length === 0) { // 第一个 item 直接 push\r\n      items.push(item);\r\n    } else {\r\n      let lastItem = last(items) as TocItem; // 最后一个 item\r\n\r\n      if (item.level > lastItem.level) { // item 是 lastItem 的 children\r\n        for (let i = lastItem.level + 1; i <= 2; i++) {\r\n          const { children } = lastItem;\r\n          if (!children) { // 如果 children 不存在\r\n            lastItem.children = [item];\r\n            break;\r\n          }\r\n\r\n          lastItem = last(children) as TocItem; // 重置 lastItem 为 children 的最后一个 item\r\n\r\n          if (item.level <= lastItem.level) { // item level 小于或等于 lastItem level 都视为与 children 同级\r\n            children.push(item);\r\n            break;\r\n          }\r\n        }\r\n      } else { // 置于最顶级\r\n        items.push(item);\r\n      }\r\n    }\r\n\r\n    return anchor;\r\n  }\r\n\r\n  reset = () => {\r\n    this.tocItems = [];\r\n    this.index = 0;\r\n  };\r\n\r\n  renderToc(items: TocItem[]) { // 递归 render\r\n    return items.map(item => (\r\n      <Link key={item.anchor} href={`#${item.anchor}`} title={item.text}>\r\n        {item.children && this.renderToc(item.children)}\r\n      </Link>\r\n    ));\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Anchor affix showInkInFixed>\r\n        {this.renderToc(this.tocItems)}\r\n      </Anchor>\r\n    );\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}